<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Campus Virtual - Administrador</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class="topbar">
    <h1>Panel Administrador</h1>
    <div>
      <button id="signOut" class="btn ghost">Cerrar sesión</button>
    </div>
  </header>
  <main class="container">
    <section class="card">
      <h2>Bienvenido/a</h2>
      <div id="bienvenidaAdmin">Cargando...</div>
    </section>
    <section class="card">
      <h2>Usuarios</h2>
      <p class="muted small">Aquí podés crear, ver y borrar usuarios. Los usuarios pueden ser alumnos, profesores o administradores. Para crear uno nuevo, completá los datos y presioná <b>Crear usuario</b>. Para editar, hacé clic en <b>Ver</b>. Para borrar, en <b>Borrar</b>.</p>
      <form id="createUserForm">
        <div class="row">
          <input id="u_dni" placeholder="DNI (sin espacios)" required />
          <input id="u_nombre" placeholder="Nombre completo" required />
        </div>
        <div class="row">
          <select id="u_rol">
            <option value="alumno">Alumno</option>
            <option value="profesor">Profesor</option>
            <option value="admin">Administrador</option>
          </select>
          <input id="u_curso" placeholder="Curso (ej: 4to A)" />
        </div>
        <div class="row">
          <select id="u_turno">
            <option value="">-- Turno --</option>
            <option value="Mañana">Mañana</option>
            <option value="Tarde">Tarde</option>
          </select>
          <button class="btn primary" type="submit">Crear usuario</button>
        </div>
        <p class="muted small">La contraseña por defecto será: 8 + DNI</p>
      </form>
      <div id="usersList"></div>
    </section>
    <section class="card">
      <h2>Materias</h2>
      <p class="muted small">En este apartado podés crear nuevas materias y ver todas las existentes. Para cada materia, asigná un profesor (DNI) y un horario. El listado muestra cuántos alumnos están inscriptos en cada materia.</p>
      <form id="createMateriaForm">
        <div class="row">
          <input id="m_id" placeholder="ID Materia (ej: M1)" required />
          <input id="m_nombre" placeholder="Nombre de la materia" required />
        </div>
        <div class="row">
          <input id="m_profesor" placeholder="DNI Profesor" />
          <input id="m_horario" placeholder="Horario" />
        </div>
        <button class="btn primary" type="submit">Crear materia</button>
      </form>
      <div id="materiasList"></div>
    </section>
    <section class="card">
      <h2>Exámenes</h2>
      <p class="muted small">Desde aquí podés programar exámenes para las materias. Elegí la materia, la fecha y el turno, y presioná <b>Crear examen</b>. Abajo verás el listado de exámenes programados.</p>
      <form id="createExamenForm">
        <select id="e_materia"></select>
        <input id="e_fecha" type="date" />
        <select id="e_turno">
          <option value="Mañana">Mañana</option>
          <option value="Tarde">Tarde</option>
        </select>
        <button class="btn primary" type="submit">Crear examen</button>
      </form>
      <h3>Exámenes programados</h3>
      <div id="examenesList"></div>
    </section>
  </main>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="js/firebase-config.js" type="module"></script>
  <script src="js/db.js" type="module"></script>
  <script src="js/admin.js" type="module"></script>
  <script type="module">
    const session = JSON.parse(sessionStorage.getItem('sessionUser') || 'null');
    if (!session || session.rol !== 'admin') {
      window.location.href = 'index.html';
    } else {
      document.getElementById('signOut').addEventListener('click', ()=>{
        sessionStorage.removeItem('sessionUser');
        window.location.href='index.html';
      });
      document.getElementById('bienvenidaAdmin').innerHTML = `
        <p>Hola <strong>${session.nombre}</strong> (${session.dni})</p>
        <p>Desde aquí podés gestionar usuarios, materias y exámenes de toda la institución.</p>
        <p>Utilizá los formularios y listados para administrar el sistema de manera sencilla.</p>
      `;
    }
  </script>
</body>
</html>
